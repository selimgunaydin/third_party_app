<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechStore | Analytics Widget Test Sayfası</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>

<body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center">
                    <h1 class="text-2xl font-bold text-blue-600">TechStore</h1>
                </div>

                <!-- Arama -->
                <div class="flex-1 max-w-2xl mx-8">
                    <div class="relative">
                        <input type="text" placeholder="Ürün ara..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <button onclick="handleSearch()" class="absolute right-2 top-2 text-gray-400 hover:text-blue-600">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- Sağ Menü -->
                <div class="flex items-center space-x-4">
                    <button onclick="handleLogin()" class="text-gray-600 hover:text-blue-600">
                        <i class="fas fa-user mr-1"></i>
                        <span>Giriş</span>
                    </button>
                    <button onclick="viewWishlist()" class="text-gray-600 hover:text-blue-600">
                        <i class="fas fa-heart mr-1"></i>
                        <span>Favoriler</span>
                    </button>
                    <button onclick="viewCart()" class="text-gray-600 hover:text-blue-600">
                        <i class="fas fa-shopping-cart mr-1"></i>
                        <span>Sepet</span>
                    </button>
                </div>
            </div>

            <!-- Kategoriler -->
            <nav class="flex space-x-8 py-4">
                <a href="#" class="text-gray-600 hover:text-blue-600">Telefonlar</a>
                <a href="#" class="text-gray-600 hover:text-blue-600">Bilgisayarlar</a>
                <a href="#" class="text-gray-600 hover:text-blue-600">Tabletler</a>
                <a href="#" class="text-gray-600 hover:text-blue-600">Aksesuarlar</a>
                <a href="#" class="text-gray-600 hover:text-blue-600">Kulaklıklar</a>
                <a href="#" class="text-gray-600 hover:text-blue-600">Akıllı Saatler</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Test Kontrolleri -->
            <div id="test-controls" class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Analytics Test Kontrolleri</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="identifyUser()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Kullanıcıyı Tanımla</button>
                    <button onclick="handleLogin()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Test Girişi Yap</button>
                    <button onclick="handleRegister()" class="bg-red-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Test Kayıt Yap</button>      
                    <button onclick="handleForgotPassword()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Şifremi Unuttum</button>
                </div>
            </div>

            <!-- Ürünler -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Ürün 1 -->
                <div class="bg-white rounded-lg shadow-md p-6 product-card">
                    <div class="relative group">
                        <img src="https://picsum.photos/400/400?random=1" alt="iPhone 14 Pro" class="w-full h-48 object-cover rounded-lg mb-4">
                        <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="addToWishlist('PROD1')" class="bg-white p-2 rounded-full shadow-md hover:bg-gray-100">
                                <i class="fas fa-heart text-red-500"></i>
                            </button>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">iPhone 14 Pro</h3>
                    <p class="text-sm text-gray-600 mb-2">256GB, Uzay Siyahı</p>
                    <p id="product-price" class="text-lg font-bold text-blue-600 mb-4">54.999 TL</p>
                    <div class="space-y-2">
                        <button onclick="viewProduct('IPHONE14PRO')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">İncele</button>
                        <button onclick="addToCart('IPHONE14PRO')" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Sepete Ekle</button>
                    </div>
                </div>

                <!-- Ürün 2 -->
                <div class="bg-white rounded-lg shadow-md p-6 product-card">
                    <div class="relative group">
                        <img src="https://picsum.photos/400/400?random=2" alt="MacBook Pro" class="w-full h-48 object-cover rounded-lg mb-4">
                        <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="addToWishlist('PROD2')" class="bg-white p-2 rounded-full shadow-md hover:bg-gray-100">
                                <i class="fas fa-heart text-red-500"></i>
                            </button>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">MacBook Pro</h3>
                    <p class="text-sm text-gray-600 mb-2">M2 Pro, 16GB RAM, 512GB SSD</p>
                    <p id="product-price" class="text-lg font-bold text-blue-600 mb-4">72.999 TL</p>
                    <div class="space-y-2">
                        <button onclick="viewProduct('MACBOOKPRO')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">İncele</button>
                        <button onclick="addToCart('MACBOOKPRO')" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Sepete Ekle</button>
                    </div>
                </div>

                <!-- Ürün 3 -->
                <div class="bg-white rounded-lg shadow-md p-6 product-card">
                    <div class="relative group">
                        <img src="https://picsum.photos/400/400?random=3" alt="iPad Air" class="w-full h-48 object-cover rounded-lg mb-4">
                        <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="addToWishlist('PROD3')" class="bg-white p-2 rounded-full shadow-md hover:bg-gray-100">
                                <i class="fas fa-heart text-red-500"></i>
                            </button>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">iPad Air</h3>
                    <p class="text-sm text-gray-600 mb-2">256GB, Gök Mavisi</p>
                    <p id="product-price" class="text-lg font-bold text-blue-600 mb-4">24.999 TL</p>
                    <div class="space-y-2">
                        <button onclick="viewProduct('IPADAIR')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">İncele</button>
                        <button onclick="addToCart('IPADAIR')" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Sepete Ekle</button>
                    </div>
                </div>

                <!-- Ürün 4 -->
                <div class="bg-white rounded-lg shadow-md p-6 product-card">
                    <div class="relative group">
                        <img src="https://picsum.photos/400/400?random=4" alt="AirPods Pro" class="w-full h-48 object-cover rounded-lg mb-4">
                        <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="addToWishlist('PROD4')" class="bg-white p-2 rounded-full shadow-md hover:bg-gray-100">
                                <i class="fas fa-heart text-red-500"></i>
                            </button>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">AirPods Pro</h3>
                    <p class="text-sm text-gray-600 mb-2">2. Nesil, Beyaz</p>
                    <p id="product-price" class="text-lg font-bold text-blue-600 mb-4">7.999 TL</p>
                    <div class="space-y-2">
                        <button onclick="viewProduct('AIRPODSPRO')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">İncele</button>
                        <button onclick="addToCart('AIRPODSPRO')" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Sepete Ekle</button>
                    </div>
                </div>
            </div>

            <!-- Test Formları -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                <!-- İletişim Formu -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">İletişim Formu</h2>
                    <form name="contactForm" id="contactForm" class="space-y-4">
                        <input value="GTM Test Userr" type="text" name="name" placeholder="Adınız" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <input value="gtm_user123456@example.com" type="email" name="email" placeholder="E-posta" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <textarea name="message" placeholder="Mesajınız" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-32">Merhaba, bu bir test mesajıdır.</textarea>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150">Gönder</button>
                    </form>
                </div>

                <!-- Sepet -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Sepetim</h2>
                    <div id="cartItems" class="mb-4 space-y-4">
                        <!-- Sepet öğeleri buraya dinamik olarak eklenecek -->
                    </div>
                    <div class="border-t border-gray-200 pt-4 mt-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-gray-600">Ara Toplam:</span>
                            <span id="subtotal" class="text-lg font-semibold text-gray-800">0.00 TL</span>
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-gray-600">KDV (%18):</span>
                            <span id="tax" class="text-gray-800">0.00 TL</span>
                        </div>
                        <div class="flex justify-between items-center mb-4 text-lg font-bold">
                            <span class="text-gray-800">Toplam:</span>
                            <span id="total" class="text-blue-600">0.00 TL</span>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <button onclick="startCheckout()" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-150" id="checkoutButton" disabled>Ödemeye Geç</button>
                        <button onclick="completeCheckout('CHK' + Date.now())" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-150" id="completeButton" disabled>Ödemeyi Tamamla</button>
                        <button onclick="cancelCheckout('CHK' + Date.now())" class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition duration-150" id="cancelButton" disabled>Ödemeyi İptal Et</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Kurumsal -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Kurumsal</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white">Hakkımızda</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Kariyer</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">İletişim</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Blog</a></li>
                    </ul>
                </div>

                <!-- Müşteri Hizmetleri -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Müşteri Hizmetleri</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white">Sıkça Sorulan Sorular</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Kargo Takip</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">İade ve Değişim</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Gizlilik Politikası</a></li>
                    </ul>
                </div>

                <!-- Kategoriler -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Kategoriler</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white">Telefonlar</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Bilgisayarlar</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Tabletler</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Aksesuarlar</a></li>
                    </ul>
                </div>

                <!-- Sosyal Medya -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Bizi Takip Edin</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-white text-2xl">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-white text-2xl">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-white text-2xl">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-white text-2xl">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 TechStore. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </footer>

    <script src="http://localhost:3001/api/widget.js"></script>

    <script>
        // Fake GTM Data Layer
        window.dataLayer = window.dataLayer || [];

        // Fake GTM User Data
        window.dataLayer.push({
            'user': {
                'id': 'GTM_USER_123415617',
                'email': 'gtm_user1234567@example.com',
                'name': 'GTM Test Userrr',
                'isAuthenticated': true,
                'groups': ['customer'],
                'createdAt': '2024-01-02T00:00:00.000Z'
            }
        });

        // GTM'den kullanıcı bilgilerini al
        function getGTMUser() {
            const dataLayer = window.dataLayer || [];
            const gtmData = dataLayer.find(data => data.user);
            return gtmData ? gtmData.user : null;
        }

        const config = {
            apiKey: '9947f3c7-d9a9-4175-9286-7866008cf51a',
            apiUrl: 'http://localhost:3001'
        };

        // Analytics widget'ını yükle
        const analytics = new ThirdPartyAnalytics(config);

        // Sayfa görüntüleme olayını otomatik kaydet
        analytics.pageView();

        // Widget'ı başlat
        analytics.initializeComponents()

        // GTM kullanıcısını tanımla
        const gtmUser = getGTMUser();
        if (gtmUser && gtmUser.isAuthenticated) {
            analytics.identify(gtmUser.id, {
                email: gtmUser.email,
                name: gtmUser.name,
                registeredAt: gtmUser.createdAt
            });
        }

        // Tüm butonları izle
        document.querySelectorAll('button').forEach(button => {
            analytics.trackClick(button);
        });

        // İletişim formunu izle
        const form = document.getElementById('contactForm');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            analytics.trackFormSubmission(form);
            form.reset();
            return false;
        });

        // Auth kontrolü
        function requireAuth(callback) {
            const user = getGTMUser();
            if (!user || !user.isAuthenticated) {
                alert('Bu işlem için giriş yapmanız gerekmektedir.');
                return false;
            }
            return callback(user);
        }

        // Kullanıcı tanımlama
        function identifyUser() {
            const user = getGTMUser();
            if (user) {
                analytics.identify(user.id, {
                    customerId: user.id,
                    name: user.name,
                    email: user.email,
                    registeredAt: user.createdAt
                });
            }
        }

        // Ürün görüntüleme
        function viewProduct(productId) {
            const user = getGTMUser();
            analytics.productViewed({
                productId,
                name: document.querySelector(`button[onclick="viewProduct('${productId}')"]`).closest('.product-card').querySelector('h3').textContent,
                price: parseFloat(document.querySelector(`button[onclick="viewProduct('${productId}')"]`).closest('.product-card').querySelector('#product-price').textContent.split(' ')[0]),
                category: 'Test Ürünleri',
                customerId: user.id
            });
        }

        // Sepet verilerini tutan obje
        let cart = {
            items: [],
            total: 0,
            tax: 0,
            subtotal: 0
        };

        // Para birimini formatla
        function formatCurrency(amount) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY'
            }).format(amount);
        }

        // Sepeti güncelle
        function updateCart() {
            const cartItemsDiv = document.getElementById('cartItems');
            const subtotalSpan = document.getElementById('subtotal');
            const taxSpan = document.getElementById('tax');
            const totalSpan = document.getElementById('total');
            const checkoutButton = document.getElementById('checkoutButton');
            const completeButton = document.getElementById('completeButton');
            const cancelButton = document.getElementById('cancelButton');

            // Sepet boşsa
            if (cart.items.length === 0) {
                cartItemsDiv.innerHTML = '<p class="text-gray-500 text-center py-4">Sepetiniz boş</p>';
                checkoutButton.disabled = true;
                completeButton.disabled = true;
                cancelButton.disabled = true;
                subtotalSpan.textContent = formatCurrency(0);
                taxSpan.textContent = formatCurrency(0);
                totalSpan.textContent = formatCurrency(0);
                return;
            }

            // Sepet öğelerini listele
            cartItemsDiv.innerHTML = cart.items.map(item => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-4">
                        <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md">
                        <div>
                            <h3 class="text-sm font-semibold text-gray-800">${item.name}</h3>
                            <p class="text-sm text-gray-600">${item.description}</p>
                            <p class="text-sm font-bold text-blue-600">${formatCurrency(item.price)}</p>
                        </div>
                    </div>
                    <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700 transition duration-150">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');

            // Toplamları güncelle
            cart.subtotal = cart.items.reduce((sum, item) => sum + item.price, 0);
            cart.tax = cart.subtotal * 0.18;
            cart.total = cart.subtotal + cart.tax;

            subtotalSpan.textContent = formatCurrency(cart.subtotal);
            taxSpan.textContent = formatCurrency(cart.tax);
            totalSpan.textContent = formatCurrency(cart.total);

            // Butonları aktifleştir
            checkoutButton.disabled = false;
            completeButton.disabled = false;
            cancelButton.disabled = false;

            // Analytics'e sepet güncellemesini bildir
            analytics.addToCart({
                productId: 'CART' + Date.now(),
                items: cart.items,
                total: cart.total,
                currency: 'TRY'
            });
        }

        // Sepete ürün ekle
        function addToCart(productId) {
            const products = {
                'IPHONE14PRO': {
                    id: 'IPHONE14PRO',
                    name: 'iPhone 14 Pro',
                    description: '256GB, Uzay Siyahı',
                    price: 54999,
                    image: 'https://picsum.photos/400/400?random=1'
                },
                'MACBOOKPRO': {
                    id: 'MACBOOKPRO',
                    name: 'MacBook Pro',
                    description: 'M2 Pro, 16GB RAM, 512GB SSD',
                    price: 72999,
                    image: 'https://picsum.photos/400/400?random=2'
                },
                'IPADAIR': {
                    id: 'IPADAIR',
                    name: 'iPad Air',
                    description: '256GB, Gök Mavisi',
                    price: 24999,
                    image: 'https://picsum.photos/400/400?random=3'
                },
                'AIRPODSPRO': {
                    id: 'AIRPODSPRO',
                    name: 'AirPods Pro',
                    description: '2. Nesil, Beyaz',
                    price: 7999,
                    image: 'https://picsum.photos/400/400?random=4'
                }
            };

            const product = products[productId];
            if (product) {
                cart.items.push(product);
                updateCart();

                // Analytics'e sepete ekleme olayını bildir
                analytics.addToCart({
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    customerId: getGTMUser()?.id
                });
            }
        }

        // Sepetten ürün çıkar
        function removeFromCart(productId) {
            const index = cart.items.findIndex(item => item.id === productId);
            if (index > -1) {
                const removedItem = cart.items[index];
                cart.items.splice(index, 1);
                updateCart();

                // Analytics'e sepetten çıkarma olayını bildir
                analytics.removeFromCart({
                    productId: removedItem.id,
                    name: removedItem.name,
                    customerId: getGTMUser()?.id
                });
            }
        }

        // Ödeme başlat
        function startCheckout() {
            if (cart.items.length > 0) {
                analytics.checkoutStarted({
                    checkoutId: 'CHK' + Date.now(),
                    total: cart.total,
                    currency: 'TRY',
                    customerId: getGTMUser()?.id,
                    products: cart.items.map(item => ({
                        productId: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: 1
                    }))
                });
            }
        }

        // Ödeme tamamla
        function completeCheckout(checkoutId) {
            if (cart.items.length > 0) {
                analytics.checkoutCompleted({
                    checkoutId,
                    total: cart.total,
                    currency: 'TRY',
                    paymentMethod: 'credit_card',
                    status: 'success',
                    customerId: getGTMUser()?.id,
                    products: cart.items.map(item => ({
                        productId: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: 1
                    }))
                });
                // Sepeti temizle
                cart.items = [];
                updateCart();
            }
        }

        // Ödeme iptal
        function cancelCheckout(checkoutId) {
            if (cart.items.length > 0) {
                analytics.checkoutCancelled({
                    checkoutId,
                    total: cart.total,
                    currency: 'TRY',
                    status: 'cancelled',
                    customerId: getGTMUser()?.id,
                    errorMessage: 'Kullanıcı tarafından iptal edildi'
                });
            }
        }

        // Kullanıcı girişi
        function handleLogin() {
            const user = getGTMUser();
            analytics.login({
                customerId: user.id,
                email: user.email,
                method: 'email',
                status: 'success',
            });
        }

        function handleRegister() {
            const user = getGTMUser();
            analytics.register({
                customerId: user.id,
                email: user.email,
                method: 'email',
                status: 'success',
            });
        }
        function handleRegister() {
            const user = getGTMUser();
            analytics.register({
                customerId: user.id,
                email: user.email,
                method: 'email',
                status: 'success'
            });
        }

        // Şifremi unuttum
        function handleForgotPassword() {
            const user = getGTMUser();
            analytics.forgotPassword({
                customerId: user.id,
                email: user.email,
                status: 'sent',
            });
        }

        // İstek listesine ekleme
        function addToWishlist(productId) {
            requireAuth((user) => {
                analytics.addWishlist({
                    productId,
                    customerId: user.id,
                    productName: document.querySelector(`button[onclick="addToWishlist('${productId}')"]`).closest('.product').querySelector('h3').textContent,
                    price: parseFloat(document.querySelector(`button[onclick="addToWishlist('${productId}')"]`).closest('.product').querySelector('p').textContent),
                    category: 'Test Ürünleri'
                });
            });
        }

        function handleSearch() {
            const query = document.querySelector('input[placeholder="Ürün ara..."]').value;
            const user = getGTMUser();
            analytics.search({
                query: query,
                customerId: user.id
            });
        }

        // İstek listesinden çıkarma
        function removeFromWishlist(productId) {
            requireAuth((user) => {
                analytics.removeWishlist({
                    productId,
                    customerId: user.id,
                    productName: document.querySelector(`button[onclick="removeFromWishlist('${productId}')"]`).closest('.product').querySelector('h3').textContent,
                    category: 'Test Ürünleri'
                });
            });
        }

        // Sayfa yüklendiğinde sepeti güncelle
        updateCart();
    </script>
</body>

</html>